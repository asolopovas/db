import{d as K,p as m,ar as O,C as U,E as J,B as f,L as s,e as k,k as w,f as l,r as S,F as x,K as b,i as a,h as X,M as r,au as Z,N as ee,Q as te,ap as se,o as i,am as B}from"./app-CyHHzooV.js";import{_ as oe}from"./DisplayField.vue_vue_type_script_setup_true_lang-DcdS5_g8.js";const ae=["src"],le={class:"max-w-[1004px] mx-auto shadow-lg"},re={class:"flex flex-wrap bg-stone-200 mx-auto mt-4 py-4"},ne={class:"flex flex-col gap-3 items-start w-full p-4"},ie={class:"grid md:grid-cols-2 lg:grid-cols-4 w-full gap-2 mb-4"},de={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-3 w-full"},ue={class:"flex flex-col w-full"},ce={class:"order-controls grid md:grid-cols-2 lg:grid-cols-4 gap-2"},me={class:"flex flex-col mb-4 w-full"},fe={class:"messages-controls grid grid-cols-2 lg:grid lg:grid-cols-4 gap-2"},pe={class:"flex gap-4 w-full justify-end pb-12"},ge={class:"toggle-container"},ve={class:"w-1/2 grid grid-cols-2 gap-2 col-start-2 items-center"},_e=K({__name:"Details",setup(we){const R=se(),d=J(),E=m({}),C=m(!1),y=m(!1),M=m(null),D=m(!1),F=m(!1),N=m(!1),_=m([]),I=m({setter:"setOrderStats",parent:"order",items:{customer:{type:"input-search",format:t=>`${t.firstname} ${t.lastname}`},status:{type:"input-search",skip:[2]},project:{type:"input-search",format:t=>t?t.street:""},company:{type:"input-search"}}}),$=m({setter:"setOrderStats",parent:"order",items:{date_due:{type:"input-field",cast:"date",format:t=>O.dateFormat(t,"yyyy-MM-dd")},vat:{type:"input-field"},discount:{type:"input-field"},due:{type:"input-field"},due_amount:{type:"input-field"}}}),T=m({setter:"setOrderStats",parent:"order",items:{created_at:{label:"Created At",type:"display-field",format:O.dateFormat},updated_at:{label:"Updated At",type:"display-field",format:O.dateFormat},sent:{type:"display-field",format:O.dateFormat}}}),V=U({get:()=>d.state.order.reverse_charge,set:t=>{d.commit("setOrderStats",{value:t,loc:"reverse_charge"}),h(!1)}}),j=U(()=>d.state.auth.access_token);async function q(){C.value=!1,y.value=!0,await d.dispatch("orderSend"),y.value=!1}function h(t=!1){_.value.length||(y.value=!0,d.dispatch("orderSave",t).then(()=>y.value=!1))}const L=async()=>{const t=d.state.order.status.name==="Quote"?"/api/settings/get/quotation_message":"/api/settings/get/invoice_message";try{const{data:e}=await B(t,{method:"GET"});d.commit("setOrderStats",{value:e,loc:"mail_message"}),h(!0)}catch(e){console.error("Failed to fetch mail message:",e)}};function P(){d.dispatch("orderSaveItem",{mail_message:d.state.order.mail_message})}const Y=async()=>{try{const{data:t}=await B(`/api/orders/${d.state.order.id}/download`,{method:"GET",responseType:"blob"}),e=t,v=window.URL.createObjectURL(e),n=document.createElement("a");n.href=v;const c=d.state.order,g=[c.customer.firstname,c.customer.lastname].filter(Boolean).join("-");n.download=`Order #${c.id} - ${g}.pdf`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(v)}catch(t){console.error("Failed to download invoice:",t)}};function A(){const t=Date.now(),e=`width=${window.screen.availWidth/2},height=${window.screen.availHeight-60}`;window.open(`/api/orders/${d.state.order.id}/pdf-reverse-charge?token=${j.value}&time=${t}`,"_blank",e)}function G(){const t=Date.now(),e=`location=true,resizable=yes,scrollbars=yes,status=yes,width=${window.screen.availWidth/2},height=${window.screen.availHeight-60},left=0,top=0`;window.open(`/api/orders/${d.state.order.id}/pdf-default?token=${j.value}&time=${t}`,"_blank",e)}function H(){const t=d.state.order,e=[t.customer.firstname,t.customer.lastname].filter(Boolean).join(" ");R.push({name:"orders",query:{search:e}})}async function Q(){var t,e,v;try{const n=d.state.order.id,c=await B(`/api/orders/${n}/duplicate`,{method:"POST"}),g=((e=(t=c==null?void 0:c.data)==null?void 0:t.item)==null?void 0:e.id)||((v=c==null?void 0:c.data)==null?void 0:v.id);g&&R.push({path:`/orders/${g}/details`})}catch(n){console.error("Failed to duplicate order:",n)}}return(t,e)=>{const v=b("spinner"),n=b("modal"),c=b("input-field"),g=b("text-area"),u=b("base-button"),W=b("input-search"),z=b("order-components");return i(),f(z,{ref:"detailsContainer"},{title:s(()=>e[12]||(e[12]=[a("Details",-1)])),loading:s(()=>[y.value?(i(),f(v,{key:0})):w("",!0)]),meta:s(()=>[(i(!0),k(x,null,S(T.value.items,(o,p)=>(i(),f(oe,{key:p,label:o.label,format:o.format,alerts:_.value,loc:`${T.value.parent}.${p}`},null,8,["label","format","alerts","loc"]))),128))]),default:s(()=>[(i(!0),k(x,null,S(E.value,(o,p)=>(i(),k(x,{key:p},[o.shown?(i(),f(n,{key:0,class:"send",controls:!0,onClose:()=>o.shown=!1,onYes:o.action,onNo:()=>o.shown=!1},{default:s(()=>[a(X(o.message),1)]),_:2},1032,["onClose","onYes","onNo"])):w("",!0)],64))),128)),C.value?(i(),f(n,{key:0,class:"send",controls:!0,onClose:e[0]||(e[0]=()=>C.value=!1),onYes:q},{default:s(()=>e[13]||(e[13]=[a(" Do you wish to send this order? ",-1)])),_:1,__:[13]})):w("",!0),M.value?(i(),f(n,{key:1,class:"pdf",controls:!1,onClose:e[1]||(e[1]=()=>M.value=null)},{default:s(()=>[l("embed",{id:"pdf",src:M.value,type:"application/pdf",width:"1000",height:"550"},null,8,ae)]),_:1})):w("",!0),D.value?(i(),f(n,{key:2,class:"textarea",onClose:e[2]||(e[2]=o=>D.value=!1)},{title:s(()=>e[14]||(e[14]=[a("Mail Message",-1)])),default:s(()=>[r(c,{set:"setOrderStats",loc:"order.cc",alerts:_.value},null,8,["alerts"]),r(g,{class:"mb-4",labelOn:!1,set:"setOrderStats",loc:"order.mail_message",action:P}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:L},{default:s(()=>e[15]||(e[15]=[a(" Default ",-1)])),_:1,__:[15]})]),_:1})):w("",!0),N.value?(i(),f(n,{key:3,class:"textarea",onClose:e[4]||(e[4]=o=>N.value=!1)},{title:s(()=>e[16]||(e[16]=[a("Payment Terms",-1)])),default:s(()=>[r(g,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.payment_terms"}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:e[3]||(e[3]=()=>h(!0))},{default:s(()=>e[17]||(e[17]=[a(" Save ",-1)])),_:1,__:[17]})]),_:1})):w("",!0),F.value?(i(),f(n,{key:4,class:"textarea",onClose:e[5]||(e[5]=o=>F.value=!1)},{title:s(()=>e[18]||(e[18]=[a("Notes",-1)])),default:s(()=>[r(g,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.notes"}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:L},{default:s(()=>e[19]||(e[19]=[a(" Default ",-1)])),_:1,__:[19]})]),_:1})):w("",!0),l("div",le,[l("div",re,[l("div",ne,[l("div",ie,[(i(!0),k(x,null,S(I.value.items,(o,p)=>(i(),f(W,{wrap:"w-full md:w-auto",class:"w-full lg:max-w-[195px]",is:o.type,set:I.value.setter,skip:o.skip,format:o.format,cast:o.cast,alerts:_.value,loc:`${$.value.parent}.${p}`},null,8,["is","set","skip","format","cast","alerts","loc"]))),256))]),l("div",de,[(i(!0),k(x,null,S($.value.items,(o,p)=>(i(),f(Z(o.type),{class:"w-full lg:w-auto",label:p,set:$.value.setter,format:o.format,cast:o.cast,alerts:_.value,loc:`${$.value.parent}.${p}`},null,8,["label","set","format","cast","alerts","loc"]))),256))]),l("div",ue,[e[24]||(e[24]=l("hr",null,null,-1)),l("div",ce,[r(u,{class:"btn-action bg-red-400",onClick:A},{default:s(()=>e[20]||(e[20]=[a(" Reverse Charge Invoice ",-1)])),_:1,__:[20]}),r(u,{class:"btn-action bg-yellow-500",onClick:G},{default:s(()=>e[21]||(e[21]=[a(" View Invoice ",-1)])),_:1,__:[21]}),r(u,{class:"btn-action bg-green-600 text-white",onClick:Y},{default:s(()=>e[22]||(e[22]=[a(" Download Invoice ",-1)])),_:1,__:[22]}),r(u,{class:"btn-action bg-orange-400",onClick:H},{default:s(()=>e[23]||(e[23]=[a(" View Related Orders ",-1)])),_:1,__:[23]})])]),l("div",me,[e[28]||(e[28]=l("hr",{class:"mb-1"},null,-1)),l("div",fe,[r(u,{class:"btn-action bg-sky-600 text-white",onClick:e[6]||(e[6]=()=>D.value=!0)},{default:s(()=>e[25]||(e[25]=[a(" Mail ",-1)])),_:1,__:[25]}),r(u,{class:"btn-action bg-sky-600 text-white",onClick:e[7]||(e[7]=()=>F.value=!0)},{default:s(()=>e[26]||(e[26]=[a(" Notes ",-1)])),_:1,__:[26]}),r(u,{class:"btn-action bg-sky-600 text-white col-span-2 lg:col-span-1",onClick:e[8]||(e[8]=()=>N.value=!0)},{default:s(()=>e[27]||(e[27]=[a(" Payment Terms ",-1)])),_:1,__:[27]})])]),l("div",pe,[l("div",ge,[e[29]||(e[29]=l("label",{class:"toggle-label select-none cursor-pointer",for:"reverse-charge"},"Reverse Charge",-1)),ee(l("input",{id:"reverse-charge",type:"checkbox",class:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o)},null,512),[[te,V.value]]),e[30]||(e[30]=l("label",{for:"reverse-charge",class:"switch cursor-pointer"},null,-1))]),l("div",ve,[r(u,{class:"btn-action bg-yellow-300 hover:bg-yellow-400 text-black",onClick:e[10]||(e[10]=()=>C.value=!0)},{default:s(()=>e[31]||(e[31]=[a(" Send ",-1)])),_:1,__:[31]}),r(u,{class:"btn-action bg-green-700 hover:bg-green-800 text-white",onClick:e[11]||(e[11]=o=>h(!1))},{default:s(()=>e[32]||(e[32]=[a(" Save ",-1)])),_:1,__:[32]}),r(u,{class:"btn-action bg-indigo-600 hover:bg-indigo-700 text-white col-span-2",onClick:Q},{default:s(()=>e[33]||(e[33]=[a(" Duplicate ",-1)])),_:1,__:[33]})])])])])])]),_:1},512)}}});export{_e as default};
