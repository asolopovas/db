import{d as z,p as c,C as v,E as G,j as N,B as f,L as u,k as D,e as d,u as r,K as y,i as b,f as t,M as P,r as w,au as H,F as x,h as s,T as J,o as l}from"./app-CZIMIw-m.js";import{u as O,b as W}from"./useConfirmation-BMFtnjWk.js";const X={class:"mt-2"},Z={key:2,class:"table-wrap"},tt={class:"table-container"},et={class:"table-order-edit"},at={"data-label":"Name",class:"t-col t-col-name"},ot={"data-label":"Quantity",class:"t-col t-col-quantity"},nt={"data-label":"Unit Price",class:"t-col t-col-unit-price"},lt={"data-label":"Unit Price",class:"t-col t-col-unit-price"},st={"data-label":"Price",class:"t-col t-col-price"},it={"data-label":"Action",class:"t-col t-col-action"},rt={colspan:"5",class:"t-col text-right"},ct={key:3,class:"text-center"},pt=z({__name:"Materials",setup(ut){const{confirmationModal:B,promptDeletion:T,confirmDeletion:A,cancelDeletion:$}=O(),i=G(),S=J(),m=c(!1),k=c(!1),h=c("add"),g=c(!1),q=c([]),C=v(()=>i.state.order.order_materials),n=v(()=>i.state.order.order_material),V=v(()=>n.value.quantity*n.value.unit_price),j=v(()=>C.value.reduce((e,a)=>e+a.unit_price*(1-a.discount/100)*a.quantity,0)),E=c({setter:"setMaterialItem",parent:"order.order_material",items:{material:{type:"input-search",format:e=>`${e.name}${e.price?" - "+N(e.price):""}`},quantity:{type:"input-field",cast:"number"},unit_price:{type:"input-field",cast:"number"},discount:{type:"input-field",cast:"number"},price:{type:"display-field",compute:e=>e.unit_price*(1-e.discount/100)*e.quantity}}});function p(){m.value=!1,k.value=!1,g.value=!1,i.commit("resetEl","order_material")}async function I(){q.value=L(n.value,["material","quantity"]),q.value.length===0&&(await i.dispatch("addEl",{el:{order_id:S.params.id,material_id:n.value.material.id,unit_price:n.value.unit_price,discount:n.value.discount,quantity:n.value.quantity},endpoint:"order_material"}),p())}function R(e){h.value="edit",i.commit("editEl",{loc:"order_material",el:e}),k.value=!0,m.value=!0}async function U(){await i.dispatch("saveEl",{el:{material_id:n.value.material.id,unit_price:n.value.unit_price,discount:n.value.discount,quantity:n.value.quantity},endpoint:"order_material"}),g.value=!0,p()}function F(){A(async e=>{i.dispatch("removeEl",{loc:"order_materials",el:e})})}function L(e,a){return a.filter(_=>!e[_])}return(e,a)=>{const _=y("modal"),Q=y("action-buttons"),K=y("view-buttons"),Y=y("order-components");return l(),f(Y,{onAddItem:a[0]||(a[0]=o=>m.value=!0)},{title:u(()=>a[1]||(a[1]=[b("Materials",-1)])),default:u(()=>[r(B)?(l(),f(_,{key:0,controls:!0,class:"send",onClose:r($),onNo:r($),onYes:F},{default:u(()=>a[2]||(a[2]=[b(" Do you confirm deletion? ",-1)])),_:1,__:[2]},8,["onClose","onNo"])):D("",!0),m.value?(l(),f(_,{key:1,onClose:p},{title:u(()=>[b(s(e.$filters.startCase(h.value))+" Material",1)]),default:u(()=>[(l(!0),d(x,null,w(E.value.items,(o,M)=>(l(),f(H(o.type),{key:M,class:"mb-3",cast:o.cast,loc:`${E.value.parent}.${M}`,set:E.value.setter,format:o.format,alerts:q.value},null,8,["cast","loc","set","format","alerts"]))),128)),t("span",X,[a[3]||(a[3]=t("b",null,"Sub-Total: ",-1)),b(s(r(N)(V.value)),1)]),P(Q,{class:"flex justify-end gap-2 pt-4",mode:h.value,buttons:r(W),onSave:U,onCancel:p,onAdd:I},null,8,["mode","buttons"])]),_:1})):D("",!0),C.value.length?(l(),d("div",Z,[t("div",tt,[t("table",et,[a[5]||(a[5]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-name"},"Name"),t("th",{class:"t-col t-col-quantity"},"Quantity"),t("th",{class:"t-col t-col-unit-price"},"Unit Price"),t("th",{class:"t-col t-col-unit-price"},"Discount"),t("th",{class:"t-col t-col-price"},"Price"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(l(!0),d(x,null,w(C.value,o=>(l(),d("tr",{key:o.id},[t("td",at,s(o.name||""),1),t("td",ot,s(o.quantity)+" units ",1),t("td",nt,s(e.$filters.currency(o.unit_price)),1),t("td",lt,s(o.discount)+"% ",1),t("td",st,s(e.$filters.currency(o.price)),1),t("td",it,[P(K,{class:"flex justify-end gap-2",onRemove:()=>r(T)(o),onEdit:M=>R(o)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",rt," Total: "+s(r(N)(j.value)),1),a[4]||(a[4]=t("td",null,null,-1))])])])])])):(l(),d("div",ct," No Materials Present "))]),_:1})}}});export{pt as default};
