import{d as K,p as v,C as E,E as Y,B as y,L as d,k as g,e as _,u as l,K as b,i as k,f as t,M as N,r as $,au as q,F as M,h as c,j as z,o as s}from"./app-BQEIzQZe.js";import{u as G,b as H}from"./useConfirmation-DZ3YAK0W.js";const J={class:"frame-add mb-4"},O={key:2,class:"table-wrap"},Q={class:"table-container"},U={class:"table-order-edit"},W={"data-label":"Date",class:"t-col t-col-date"},X={"data-label":"Description",class:"t-col t-col-description"},Z={"data-label":"Amount",class:"t-col t-col-amount"},tt={"data-label":"Action",class:"t-col t-col-action"},et={colspan:"3",class:"t-col text-right"},st=K({__name:"Payments",setup(ot){const{confirmationModal:x,promptDeletion:B,confirmDeletion:w,cancelDeletion:A}=G(),a=Y(),r=v(!1),i=v("add"),h=v([]),C=E(()=>a.state.order.payments),u=E(()=>a.state.order.payment),P=E(()=>C.value.reduce((n,e)=>n+e.amount,0)),D=v({setter:"setPaymentItem",parent:"order.payment",items:{description:{type:"input-field"},date:{type:"input-field",cast:"date"},amount:{type:"input-field"}}});function m(){r.value=!1,i.value="add",a.commit("resetEl","payment")}function V(){h.value=S(u.value,["amount","date","description"]),h.value.length||a.dispatch("addEl",{el:{...u.value,amount:Number(u.value.amount.replace(/[^0-9.\-]+/g,"")),order_id:a.state.order.id},endpoint:"payment"}).then(m)}function j(n){r.value=!0,i.value="edit",a.commit("editEl",{loc:"payment",el:n})}function F(){a.dispatch("saveEl",{el:u.value,endpoint:"payment"}).then(m)}function I(){w(async n=>{a.dispatch("removeEl",{loc:"payments",el:n})})}function S(n,e){return e.filter(p=>!n[p])}return(n,e)=>{const p=b("modal"),T=b("action-buttons"),L=b("view-buttons"),R=b("order-components");return s(),y(R,{onAddItem:e[0]||(e[0]=o=>r.value=!0)},{title:d(()=>e[1]||(e[1]=[k("Payments",-1)])),default:d(()=>[l(x)?(s(),y(p,{key:0,controls:!0,class:"send",onClose:l(A),onNo:l(A),onYes:I},{default:d(()=>e[2]||(e[2]=[k(" Do you confirm deletion? ",-1)])),_:1,__:[2]},8,["onClose","onNo"])):g("",!0),r.value?(s(),y(p,{key:1,class:"payment",onClose:m},{title:d(()=>[k(c(i.value?"Edit":"Add")+" Payment",1)]),default:d(()=>[t("div",J,[(s(!0),_(M,null,$(D.value.items,(o,f)=>(s(),y(q(o.type),{key:f,loc:`${D.value.parent}.${f}`,set:D.value.setter,format:o.format,cast:o.cast,alerts:h.value},null,8,["loc","set","format","cast","alerts"]))),128)),N(T,{class:"flex justify-end gap-2 pt-4",mode:i.value,buttons:l(H),onSave:F,onCancel:m,onAdd:V},null,8,["mode","buttons"])])]),_:1})):g("",!0),C.value.length?(s(),_("div",O,[t("div",Q,[t("table",U,[e[4]||(e[4]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-date",scope:"col"}," Date "),t("th",{class:"t-col t-col-description"},"Description"),t("th",{class:"t-col t-col-amount"},"Amount"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(s(!0),_(M,null,$(C.value,o=>(s(),_("tr",{key:o.id},[t("td",W,c(n.$filters.dateFormat(o.date,"dd MMM yyyy")),1),t("td",X,c(o.description),1),t("td",Z,c(n.$filters.currency(o.amount)),1),t("td",tt,[N(L,{class:"flex justify-end gap-2",onRemove:f=>l(B)(o),onEdit:f=>j(o)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",et," Total: "+c(l(z)(P.value)),1),e[3]||(e[3]=t("td",null,null,-1))])])])])])):g("",!0)]),_:1})}}});export{st as default};
