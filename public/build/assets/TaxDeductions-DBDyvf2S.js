import{d as Y,C as q,p,D as C,E as v,o as s,B as _,G as d,i as g,u as r,j as E,h as u,e as y,r as k,au as z,F as A,L as M,f as t,av as H}from"./app-Cn69L5Cc.js";import{u as J,b as K}from"./useConfirmation-D0auDgnd.js";const O={key:2,class:"table-wrap"},P={class:"table-container"},Q={class:"table-order-edit"},U={"data-label":"Date",class:"t-col t-col-date"},W={"data-label":"Ref",class:"t-col t-col-name"},X={"data-label":"Amount",class:"t-col t-col-amount text-right"},Z={"data-label":"Action",class:"t-col text-right"},tt={class:"t-col text-right",colspan:"3"},nt=Y({__name:"TaxDeductions",setup(et){const{confirmationModal:N,promptDeletion:w,confirmDeletion:B,cancelDeletion:$}=J(),n=q(),c=p(!1),i=p("add"),b=p([]),x=C(()=>n.state.order.tax_deductions),l=C(()=>n.state.order.tax_deduction),T=C(()=>x.value.reduce((e,o)=>e+o.amount,0)),D=p({setter:"setDeductionItem",parent:"order.tax_deduction",items:{date:{type:"input-field",cast:"date",format:e=>H(e,"yyyy-MM-dd")},ref:{type:"input-field"},amount:{type:"input-field",cast:"number"}}});function m(){c.value=!1,i.value="add",n.commit("resetEl","tax_deduction")}async function F(){b.value=I(l.value,["amount","ref","date"]),b.value.length||(await n.dispatch("addEl",{el:{ref:l.value.ref,amount:l.value.amount,date:l.value.date,order_id:n.state.order.id},endpoint:"tax_deduction"}),m())}function R(e){c.value=!0,i.value="edit",n.commit("editEl",{loc:"tax_deduction",el:e})}function V(){n.dispatch("saveEl",{el:{ref:l.value.ref,amount:l.value.amount,date:l.value.date},endpoint:"tax_deduction"}).then(m)}function j(){B(async e=>{n.dispatch("removeEl",{loc:"tax_deductions",el:e})})}function I(e,o){return o.filter(f=>!e[f])}return(e,o)=>{const f=v("modal"),S=v("action-buttons"),L=v("view-buttons"),G=v("order-components");return s(),_(G,{onAddItem:o[0]||(o[0]=a=>c.value=!0)},{title:d(()=>o[1]||(o[1]=[g("Tax Deductions")])),default:d(()=>[r(N)?(s(),_(f,{key:0,controls:!0,class:"send",onClose:r($),onNo:r($),onYes:j},{default:d(()=>o[2]||(o[2]=[g(" Do you confirm deletion? ")])),_:1},8,["onClose","onNo"])):E("",!0),c.value?(s(),_(f,{key:1,class:"payment",onClose:m},{title:d(()=>[g(u(e.$filters.startCase(i.value))+" Deduction",1)]),default:d(()=>[(s(!0),y(A,null,k(D.value.items,(a,h)=>(s(),_(z(a.type),{key:h,loc:`${D.value.parent}.${h}`,set:D.value.setter,format:a.format,cast:a.cast,alerts:b.value},null,8,["loc","set","format","cast","alerts"]))),128)),M(S,{class:"flex justify-end gap-2 pt-4",mode:i.value,buttons:r(K),onSave:V,onCancel:m,onAdd:F},null,8,["mode","buttons"])]),_:1})):E("",!0),x.value.length?(s(),y("div",O,[t("div",P,[t("table",Q,[o[4]||(o[4]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-date"},"Date"),t("th",{class:"t-col t-col-ref"},"Ref"),t("th",{class:"t-col t-col-amount"},"Amount"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(s(!0),y(A,null,k(x.value,a=>(s(),y("tr",{key:a.id},[t("td",U,u(e.$filters.dateFormat(a.date,"dd MM yyyy")),1),t("td",W,u(a.ref),1),t("td",X,u(e.$filters.currency(a.amount)),1),t("td",Z,[M(L,{class:"flex justify-end gap-2",onRemove:()=>r(w)(a),onEdit:h=>R(a)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",tt," Total: "+u(e.$filters.currency(T.value)),1),o[3]||(o[3]=t("td",null,null,-1))])])])])])):E("",!0)]),_:1})}}});export{nt as default};
