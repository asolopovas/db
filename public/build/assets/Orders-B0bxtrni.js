import{e as v,o as r,f as e,aq as nt,d as E,C as V,E as Z,F as H,r as R,u as d,n as Q,s as G,M as p,L as f,K as b,ap as K,ar as lt,am as U,p as C,ak as rt,T as it,x as N,q as ut,B as S,k as L,i as A,h as ct,N as P,O as j}from"./app-DWdjb6xN.js";import{u as dt}from"./indexView-C4155RMg.js";const pt={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 15 16"};function vt(_,s){return r(),v("svg",pt,s[0]||(s[0]=[e("path",{fill:"currentColor",d:"M7.5 11c-.28 0-.5-.22-.5-.5v-9c0-.28.22-.5.5-.5s.5.22.5.5v9c0 .28-.22.5-.5.5m6 4h-12c-.28 0-.5-.22-.5-.5v-2c0-.28.22-.5.5-.5s.5.22.5.5V14h11v-1.5c0-.28.22-.5.5-.5s.5.22.5.5v2c0 .28-.22.5-.5.5"},null,-1),e("path",{fill:"currentColor",d:"M7.5 12a.47.47 0 0 1-.35-.15l-3.5-3.5c-.2-.2-.2-.51 0-.71s.51-.2.71 0l3.15 3.15 3.15-3.15c.2-.2.51-.2.71 0s.2.51 0 .71l-3.5 3.5c-.1.1-.23.15-.35.15Z"},null,-1)]))}const ht={render:vt},mt={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 20 20"};function wt(_,s){return r(),v("svg",mt,s[0]||(s[0]=[nt('<g fill="currentColor"><path d="M14.5 14.5v-3.25a.5.5 0 0 1 1 0V15a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5h3.75a.5.5 0 0 1 0 1H5.5v9z"></path><path d="M10.354 10.354a.5.5 0 0 1-.708-.708l5-5a.5.5 0 0 1 .708.708z"></path><path d="M15.5 8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 1 0z"></path><path d="M11.5 5.5a.5.5 0 0 1 0-1H15a.5.5 0 0 1 0 1z"></path></g>',1)]))}const ft={render:wt},gt={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24"};function _t(_,s){return r(),v("svg",gt,s[0]||(s[0]=[e("path",{fill:"currentColor",d:"M3.548 20.938h16.9a.5.5 0 0 0 0-1h-16.9a.5.5 0 0 0 0 1M9.71 17.22a2.6 2.6 0 0 0 1.12-.65l9.54-9.54a1.75 1.75 0 0 0 0-2.47l-.94-.93a1.79 1.79 0 0 0-2.47 0l-9.54 9.53a2.5 2.5 0 0 0-.64 1.12L6.04 17a.74.74 0 0 0 .19.72.77.77 0 0 0 .53.22Zm.41-1.36a1.47 1.47 0 0 1-.67.39l-.97.26-1-1 .26-.97a1.5 1.5 0 0 1 .39-.67l.38-.37 1.99 1.99Zm1.09-1.08-1.99-1.99 6.73-6.73 1.99 1.99Zm8.45-8.45 2.99.97-1.99-1.99 1.01-1.02a.75.75 0 0 1 1.06 0l.93.94a.754.754 0 0 1 0 1.06Z"},null,-1)]))}const yt={render:_t},xt={xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",width:"20",height:"20",fill:"currentColor",viewBox:"0 0 100 100"};function bt(_,s){return r(),v("svg",xt,s[0]||(s[0]=[e("path",{d:"M75.272 7.482h-.005v-4.02a1.73 1.73 0 0 0-1.73-1.73h-32.87l-25.95 25.95v58.819c0 .956.774 1.73 1.73 1.73h57.089a1.73 1.73 0 0 0 1.73-1.73v-2.448h.005zM24.674 78.276V31.142h17.723a1.73 1.73 0 0 0 1.73-1.73V11.689h21.188v66.587z"},null,-1),e("path",{d:"M83.77 24.857h-3.475v66.911c0 .835-.677 1.513-1.513 1.513H29.306v3.475c0 .836.677 1.513 1.513 1.513H83.77c.836 0 1.513-.677 1.513-1.513V26.37c0-.836-.677-1.513-1.513-1.513"},null,-1)]))}const kt={render:bt},$t={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24"};function Ct(_,s){return r(),v("svg",$t,s[0]||(s[0]=[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m20 9-1.995 11.346A2 2 0 0 1 16.035 22h-8.07a2 2 0 0 1-1.97-1.654L4 9m17-3h-5.625M3 6h5.625m0 0V4a2 2 0 0 1 2-2h2.75a2 2 0 0 1 2 2v2m-6.75 0h6.75"},null,-1)]))}const Vt={render:Ct},Mt=["data-label","innerHTML"],Ot={class:"t-col t-col-action","data-label":"Action"},Bt={class:"flex gap-2 items-center justify-end md:flex text-neutral-50"},St=E({__name:"Order",props:{item:{type:Object,required:!0},fields:{type:Object},filters:{type:Object,default:()=>({grand_total:"currency",balance:"currency",vat:"percentage"})},loading:Boolean},emits:["deleteOrder","loading"],setup(_,{emit:s}){const k=K(),M=Z(),h=_,{item:m,fields:F}=h,$=V(()=>M.state.auth.access_token),q=(o,n)=>{if(h.filters.hasOwnProperty(n)){const a=h.filters[n];return lt[a](o)}return o},y=o=>{k.push({path:`/orders/${o}/details`})},g=async()=>{try{const o=await U(`/api/orders/${m.id}/download`,{method:"GET",responseType:"blob",headers:{Accept:"application/pdf"}}),n=window.URL.createObjectURL(o.data),a=document.createElement("a");a.href=n,a.setAttribute("download",`Customer - ${m.customer} #${m.id}.pdf`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}catch(o){console.error("Failed to download the file:",o)}},I=()=>{const o=window.screen.availHeight,n=window.screen.availWidth/2,a=Date.now();window.open(`/api/orders/${m.id}/pdf-default?token=${$.value}&time=${a}`,"_blank",`location=true,resizable=yes,scrollbars=yes,status=yes,width=${n},height=${o},left=0,top=0`)},O=async()=>{var o,n,a;try{const i=await U(`/api/orders/${m.id}/duplicate`,{method:"POST"}),w=((o=i==null?void 0:i.data)==null?void 0:o.id)||((a=(n=i==null?void 0:i.data)==null?void 0:n.item)==null?void 0:a.id);if(!w)throw new Error("Duplicate created but no order id returned.");const x=`/orders/${w}/details`;try{await k.push({path:x,query:{duplicated:"1"}})}catch{window.location.assign(`${x}?duplicated=1`)}}catch(i){console.error("Failed to duplicate order:",i)}};return(o,n)=>{const a=b("base-button");return r(),v("tr",null,[(r(!0),v(H,null,R(d(F),(i,w,x)=>(r(),v("td",{key:x,"data-label":d(G)(w),class:Q(i.class),innerHTML:q(d(m)[w],w)},null,10,Mt))),128)),e("td",Ot,[e("div",Bt,[p(a,{class:"btn-action bg-red-500",onClick:n[0]||(n[0]=i=>o.$emit("deleteOrder",d(m)))},{default:f(()=>[p(d(Vt))]),_:1}),p(a,{class:"btn-action bg-yellow-400 text-zinc-600",onClick:I},{default:f(()=>[p(d(ft))]),_:1}),p(a,{class:"btn-action bg-blue-600",onClick:g},{default:f(()=>[p(d(ht))]),_:1}),p(a,{class:"btn-action bg-green-600",onClick:n[1]||(n[1]=i=>y(d(m).id))},{default:f(()=>[p(d(yt))]),_:1}),p(a,{class:"btn-action bg-indigo-600",onClick:O},{default:f(()=>[p(d(kt))]),_:1})])])])}}}),Ft={class:"flex flex-wrap gap-4"},qt={class:"w-full max-w-[1366px] mx-auto"},Dt={class:"px-4 overflow-auto w-full"},Lt={class:"md:table-auto"},It=["onClick"],zt={key:0},Ht=E({__name:"Orders",setup(_){const s=it(),k=K(),M=Z(),h=V(()=>M.state.pagination),{pageSwitch:m,fetchData:F}=dt(),$=C(!1),q=C(!1),y=C(null),g=C(null),I=C(null),O=C(null),o=rt({orderStatus:null,various:null,vat:null}),n={id:{},customer:{sort:"firstname"},notes:{width:350},review_request:{},photo_request:{}},a={id:{class:"t-col t-col-id uppercase"},base_id:{class:"t-col t-col-id w-[80px] uppercase"},date:{sort:"created_at",class:"t-col t-col-date",format:l=>"$filters.dateFormat(date)"},customer:{width:200,sort:"firstname",class:"t-col t-col-customer"},address:{sort:"address_line_1",class:"t-col t-col-address"},status:{class:"t-col t-col-status"},grand_total:{class:"t-col t-col-grandtotal",width:121},vat:{class:"t-col t-col-vat"},balance:{class:"t-col t-col-balance"}},i=V(()=>M.state.items[s.name].items),w=V(()=>{const l={get(t,u){return typeof t[u]=="object"&&t[u]!==null?new Proxy(t[u],l):u in t?t[u]:null}};return I.value==="notes"?new Proxy(n,l):new Proxy(a,l)}),x=V(()=>{const l={orderBy:T.value},t=Object.entries(o).reduce((u,[z,B])=>(B&&B!=="null"&&(u[z]=B),u),{});return Object.keys(t).length&&(l.filters=t),l}),T=V(()=>y.value&&g.value?[y.value,g.value]:[]),W=l=>{O.value=l,$.value=!0},Y=()=>{O.value&&M.dispatch("orderDelete",{routeName:s.name,id:O.value.id}).then(()=>{$.value=!1})},J=l=>{l&&Object.assign(o,{orderStatus:l.orderStatus||null,various:l.various||null,vat:l.vat||null})},X=()=>{o.orderStatus=null,o.various=null,o.vat=null,k.push({query:{}})},tt=(l,t)=>{const u=l||t;if(y.value!==u){y.value=u,g.value="desc";return}g.value=g.value==="desc"?"asc":"desc"};return N(()=>T.value,()=>{k.push({query:x.value})}),N(()=>o,()=>{k.push({query:x.value})},{deep:!0}),N(s,()=>{F()}),ut(async()=>{J(s.query.filters),s.query.orderBy&&([y.value,g.value]=s.query.orderBy),await F()}),(l,t)=>{const u=b("modal"),z=b("spinner"),B=b("options"),et=b("base-button"),ot=b("pagination"),st=b("main-layout");return r(),S(st,null,{options:f(()=>[e("div",Ft,[p(B),P(e("select",{class:"h-[40px] px-4","onUpdate:modelValue":t[1]||(t[1]=c=>o.orderStatus=c),name:"statusFilters"},t[6]||(t[6]=[e("option",{value:"null"},"Status",-1),e("option",{value:"quote"},"Quotes",-1),e("option",{value:"invoice"},"Invoice",-1)]),512),[[j,o.orderStatus]]),P(e("select",{class:"h-[40px] px-4","onUpdate:modelValue":t[2]||(t[2]=c=>o.various=c),name:"variousFilters"},t[7]||(t[7]=[e("option",{value:null,selected:""}," Filter ",-1),e("option",{value:"paid"},"Paid",-1),e("option",{value:"unpaid"},"Unpaid",-1),e("option",{value:"in_progress"},"In Progress",-1),e("option",{value:"tax_deductions"},"Tax Deductions",-1)]),512),[[j,o.various]]),P(e("select",{class:"h-[40px] px-2","onUpdate:modelValue":t[3]||(t[3]=c=>o.vat=c),name:"variousFilters"},t[8]||(t[8]=[e("option",{value:null},"Vat",-1),e("option",{value:"20"},"Vat 20%",-1),e("option",{value:"5"},"Vat 5%",-1),e("option",{value:"0"},"Vat 0%",-1)]),512),[[j,o.vat]]),p(et,{class:"options-button btn-action bg-sky-600 text-white",onClick:X},{default:f(()=>t[9]||(t[9]=[A("Reset",-1)])),_:1,__:[9]})])]),default:f(()=>[$.value?(r(),S(u,{key:0,class:"yes-no-box",controls:!0,onClose:t[0]||(t[0]=c=>$.value=!1),onYes:Y},{default:f(()=>t[5]||(t[5]=[A(" Do you really want to delete this order? ",-1)])),_:1,__:[5]})):L("",!0),q.value?(r(),S(z,{key:1})):L("",!0),e("div",qt,[e("div",Dt,[e("table",Lt,[e("thead",null,[e("tr",null,[(r(!0),v(H,null,R(w.value,(c,D,at)=>(r(),v("th",{key:at,scope:"col",class:Q(["t-col cursor-pointer select-none",c.class]),onClick:Nt=>tt(c.sort,D)},ct(d(G)(String(D))),11,It))),128)),t[10]||(t[10]=e("th",{class:"t-col text-right px-2"},"Action",-1))])]),e("tbody",null,[(r(!0),v(H,null,R(i.value,c=>(r(),S(St,{key:c.id,item:c,fields:w.value,onDeleteOrder:W,onLoading:t[4]||(t[4]=D=>q.value=D)},null,8,["item","fields"]))),128)),i.value.length?L("",!0):(r(),v("tr",zt,t[11]||(t[11]=[e("td",{colspan:"10",class:"t-col text-center font-bold"}," Sorry No Records Found ",-1)])))])]),h.value.last_page&&h.value.current_page?(r(),S(ot,{key:h.value.current_page+"-"+h.value.last_page,class:"w-full justify-end py-2 bg-neutral-100","click-handler":d(m),"per-slice":5,"current-page":h.value.current_page,"last-page":h.value.last_page},null,8,["click-handler","current-page","last-page"])):L("",!0)])])]),_:1})}}});export{Ht as default};
