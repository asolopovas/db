import{d as Y,p as w,C as y,E as q,ak as G,j as c,B as _,L as p,k as D,e as i,u as d,K as h,i as P,f as e,M as A,r as $,au as H,F as x,n as J,s as Q,h as E,o as s,aw as V}from"./app-BQEIzQZe.js";import{u as U,b as X}from"./useConfirmation-DZ3YAK0W.js";const Z={class:"frame-add overflow-y-auto max-h-[500px] p-4"},tt={key:2,class:"table-wrap"},et={class:"table-container"},ot={class:"table-order-edit"},st=["data-label"],at={"data-label":"Action",class:"t-col t-col-action"},nt={colspan:"6",class:"t-col text-right"},lt={key:3,class:"text-center"},it=Y({__name:"Products",setup(rt){const{confirmationModal:B,promptDeletion:M,confirmDeletion:S,cancelDeletion:C}=U(),l=q(),m=w(!1),f=w("add"),u=w([]),g=["name","specs","discount","wastage","meterage","discountedPrice"],k=y(()=>l.state.order.products),b=y(()=>l.state.order.product),j=y(()=>l.getters.productsView),r=G({setter:"setProductComponent",parent:"order.product",items:{floor:{format:t=>`${c(t.price)} ${t.name}`,type:"input-search"},grade:{format:t=>`${c(t.price)} ${t.name}`,type:"input-search"},dimension:{format:t=>{let o=`${c(t.price)} ${t.type} `;return t.length&&(o+=`${t.length}x`),o+=`${t.width}x${t.thickness}mm`,o},type:"input-search"},extra:{format:t=>`${c(t.price)} ${t.name}`,type:"input-search"},wastage_rate:{type:"input-field"},discount:{type:"input-field"},unit_price:{type:"input-field"},meterage:{type:"input-field"},price:{format:t=>c(t),type:"display-field"},discountedPrice:{format:t=>c(t),type:"display-field"}}}),F=y(()=>k.value.reduce((t,o)=>t+o.discountedPrice,0));function v(){m.value=!1,f.value="add",Object.keys(r.items).forEach(t=>{"alert"in r.items[t]&&(r.items[t].alert=!1)}),l.commit("resetProduct")}async function T(){u.value=V(b,g),u.value.length||(f.value="add",await l.dispatch("addProduct"),v())}function L(t){l.commit("editProduct",t.id),m.value=!0,f.value="edit",I()}async function R(){u.value=V(b,g),u.value.length||(await l.dispatch("saveProduct"),v())}function z(){S(async t=>{l.dispatch("removeEl",{loc:"products",el:t})})}function I(){r.items.meterage.disabled=b.value.areas.length>0}return(t,o)=>{const N=h("modal"),K=h("action-buttons"),O=h("view-buttons"),W=h("order-components");return s(),_(W,{onAddItem:o[0]||(o[0]=a=>m.value=!0)},{title:p(()=>o[1]||(o[1]=[P("Products",-1)])),default:p(()=>[d(B)?(s(),_(N,{key:0,controls:!0,class:"send",onClose:d(C),onNo:d(C),onYes:z},{default:p(()=>o[2]||(o[2]=[P(" Do you confirm deletion? ",-1)])),_:1,__:[2]},8,["onClose","onNo"])):D("",!0),m.value?(s(),_(N,{key:1,onClose:v},{title:p(()=>o[3]||(o[3]=[P("Add Product",-1)])),default:p(()=>[e("div",Z,[(s(!0),i(x,null,$(r.items,(a,n)=>(s(),_(H(a.type),{key:n,set:r.setter,format:a.format,disabled:a.disabled,alerts:u.value,loc:`${r.parent}.${n}`},null,8,["set","format","disabled","alerts","loc"]))),128))]),A(K,{class:"flex justify-end gap-2 pt-4",mode:f.value,buttons:d(X),onSave:R,onCancel:v,onAdd:T},null,8,["mode","buttons"])]),_:1})):D("",!0),k.value.length?(s(),i("div",tt,[e("div",et,[e("table",ot,[o[5]||(o[5]=e("thead",null,[e("tr",null,[e("th",{class:"t-col w-[200px]"},"Name"),e("th",{class:"t-col"},"Specs"),e("th",{class:"t-col t-col-discount"},"Discount"),e("th",{class:"t-col t-col-wastage w-[100px]"},"Wastage"),e("th",{class:"t-col t-col-meterage"},"Meterage"),e("th",{class:"t-col t-col-price"},"Price"),e("th",{class:"t-col t-col-action"},"Action")])],-1)),e("tbody",null,[(s(!0),i(x,null,$(j.value,a=>(s(),i("tr",{key:a.id},[(s(),i(x,null,$(g,n=>e("td",{"data-label":d(Q)(n),key:n,class:J(["t-col",`t-col-${n==="discountedPrice"?"price":n}`])},E(a[n]),11,st)),64)),e("td",at,[A(O,{class:"flex justify-end gap-2",onEdit:n=>L(a.el),onRemove:()=>d(M)(a.el)},null,8,["onEdit","onRemove"])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",nt," Total: "+E(d(c)(F.value)),1),o[4]||(o[4]=e("td",null,null,-1))])])])])])):(s(),i("div",lt," No Products Available "))]),_:1})}}});export{it as default};
