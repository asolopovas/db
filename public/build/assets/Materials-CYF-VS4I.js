import{d as z,p as c,C as v,E as G,j as N,B as f,L as u,k as w,e as d,u as r,K as y,i as b,f as t,M as D,r as P,au as H,F as x,h as i,T as J,o as n}from"./app-CniiSglE.js";import{u as O,b as W}from"./useConfirmation-DLmrTeXk.js";const X={class:"mt-2"},Z={key:2,class:"table-wrap"},tt={class:"table-container"},et={class:"table-order-edit"},at={"data-label":"Name",class:"t-col t-col-name"},ot={"data-label":"Quantity",class:"t-col t-col-quantity"},lt={"data-label":"Unit Price",class:"t-col t-col-unit-price"},nt={"data-label":"Price",class:"t-col t-col-price"},st={"data-label":"Action",class:"t-col t-col-action"},rt={colspan:"4",class:"t-col text-right"},it={key:3,class:"text-center"},mt=z({__name:"Materials",setup(ct){const{confirmationModal:B,promptDeletion:T,confirmDeletion:A,cancelDeletion:$}=O(),s=G(),S=J(),m=c(!1),k=c(!1),h=c("add"),g=c(!1),C=c([]),q=v(()=>s.state.order.order_materials),l=v(()=>s.state.order.order_material),V=v(()=>l.value.quantity*l.value.unit_price),j=v(()=>q.value.reduce((a,e)=>a+e.unit_price*e.quantity,0)),E=c({setter:"setMaterialItem",parent:"order.order_material",items:{material:{type:"input-search",format:a=>`${a.name}${a.price?" - "+N(a.price):""}`},quantity:{type:"input-field",cast:"number"},unit_price:{type:"input-field",cast:"number"}}});function p(){m.value=!1,k.value=!1,g.value=!1,s.commit("resetEl","order_material")}async function I(){C.value=Q(l.value,["material","quantity"]),C.value.length===0&&(await s.dispatch("addEl",{el:{order_id:S.params.id,material_id:l.value.material.id,unit_price:l.value.unit_price,quantity:l.value.quantity},endpoint:"order_material"}),p())}function R(a){h.value="edit",s.commit("editEl",{loc:"order_material",el:a}),k.value=!0,m.value=!0}async function F(){await s.dispatch("saveEl",{el:{material_id:l.value.material.id,unit_price:l.value.unit_price,quantity:l.value.quantity},endpoint:"order_material"}),g.value=!0,p()}function L(){A(async a=>{s.dispatch("removeEl",{loc:"order_materials",el:a})})}function Q(a,e){return e.filter(_=>!a[_])}return(a,e)=>{const _=y("modal"),U=y("action-buttons"),K=y("view-buttons"),Y=y("order-components");return n(),f(Y,{onAddItem:e[0]||(e[0]=o=>m.value=!0)},{title:u(()=>e[1]||(e[1]=[b("Materials",-1)])),default:u(()=>[r(B)?(n(),f(_,{key:0,controls:!0,class:"send",onClose:r($),onNo:r($),onYes:L},{default:u(()=>e[2]||(e[2]=[b(" Do you confirm deletion? ",-1)])),_:1,__:[2]},8,["onClose","onNo"])):w("",!0),m.value?(n(),f(_,{key:1,onClose:p},{title:u(()=>[b(i(a.$filters.startCase(h.value))+" Material",1)]),default:u(()=>[(n(!0),d(x,null,P(E.value.items,(o,M)=>(n(),f(H(o.type),{key:M,class:"mb-3",cast:o.cast,loc:`${E.value.parent}.${M}`,set:E.value.setter,format:o.format,alerts:C.value},null,8,["cast","loc","set","format","alerts"]))),128)),t("span",X,[e[3]||(e[3]=t("b",null,"Sub-Total: ",-1)),b(i(r(N)(V.value)),1)]),D(U,{class:"flex justify-end gap-2 pt-4",mode:h.value,buttons:r(W),onSave:F,onCancel:p,onAdd:I},null,8,["mode","buttons"])]),_:1})):w("",!0),q.value.length?(n(),d("div",Z,[t("div",tt,[t("table",et,[e[5]||(e[5]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-name"},"Name"),t("th",{class:"t-col t-col-quantity"},"Quantity"),t("th",{class:"t-col t-col-unit-price"},"Unit Price"),t("th",{class:"t-col t-col-price"},"Price"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(n(!0),d(x,null,P(q.value,o=>(n(),d("tr",{key:o.id},[t("td",at,i(o.material.name),1),t("td",ot,i(o.quantity)+" units ",1),t("td",lt,i(a.$filters.currency(o.unit_price)),1),t("td",nt,i(a.$filters.currency(o.price)),1),t("td",st,[D(K,{class:"flex justify-end gap-2",onRemove:()=>r(T)(o),onEdit:M=>R(o)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",rt," Total: "+i(r(N)(j.value)),1),e[4]||(e[4]=t("td",null,null,-1))])])])])])):(n(),d("div",it," No Materials Present "))]),_:1})}}});export{mt as default};
