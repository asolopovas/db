import{d as W,p as r,C as x,E as Y,B as f,L as v,k as E,e as _,u as l,K as y,i as M,f as t,M as k,r as A,au as q,F as N,h as c,j as z,o as a}from"./app-C1uLOR5I.js";import{u as G,b as J}from"./useConfirmation-o5qPBQK2.js";const O={class:"frame-add mb-4"},Q={key:2,class:"table-wrap"},U={class:"table-container"},X={class:"table-order-edit"},Z={"data-label":"Date",class:"t-col t-col-date"},tt={"data-label":"Category",class:"t-col t-col-category"},et={"data-label":"Details",class:"t-col t-col-details"},ot={"data-label":"Amount",class:"t-col t-col-amount"},st={"data-label":"Action",class:"t-col t-col-action"},at={class:"t-col text-right",colspan:"4"},rt=W({__name:"Expenses",setup(nt){const{confirmationModal:$,promptDeletion:B,confirmDeletion:F,cancelDeletion:D}=G(),n=Y(),d=r(!1),b=r([]),h=r(!1),w=r("add"),g=x(()=>n.state.order.expenses),i=x(()=>n.state.order.expense),I=x(()=>g.value.reduce((s,e)=>s+e.amount,0)),V=[{name:"Transport"},{name:"Materials"},{name:"Flooring Price"},{name:"Finishing"},{name:"Wages"},{name:"Commissions"}],C=r({setter:"setExpenseItem",parent:"order.expense",items:{category:{type:"select-field"},amount:{type:"input-field"},details:{type:"input-field"}}});function u(){d.value=!1,h.value=!1,n.commit("resetEl","expense")}function j(){b.value=L(i.value,["category","amount"]),b.value.length||n.dispatch("addEl",{el:{...i.value,amount:Number(i.value.amount.replace(/[^0-9.\-]+/g,""))},endpoint:"expense"}).then(u)}function S(s){d.value=!0,h.value=!0,n.commit("editEl",{loc:"expense",el:s})}function T(){n.dispatch("saveEl",{el:i.value,endpoint:"expense"}).then(u)}function H(){F(async s=>{n.dispatch("removeEl",{loc:"expenses",el:s})})}function L(s,e){return e.filter(m=>!s[m])}return(s,e)=>{const m=y("modal"),R=y("action-buttons"),K=y("view-buttons"),P=y("order-components");return a(),f(P,{onAddItem:e[0]||(e[0]=o=>d.value=!0)},{default:v(()=>[l($)?(a(),f(m,{key:0,controls:!0,class:"send",onClose:l(D),onNo:l(D),onYes:H},{default:v(()=>e[1]||(e[1]=[M(" Do you confirm deletion? ",-1)])),_:1,__:[1]},8,["onClose","onNo"])):E("",!0),d.value?(a(),f(m,{key:1,class:"payment",onClose:u},{title:v(()=>[M(c(h.value?"Edit":"Add")+" Expense",1)]),default:v(()=>[t("div",O,[(a(!0),_(N,null,A(C.value.items,(o,p)=>(a(),f(q(o.type),{key:p,loc:`${C.value.parent}.${p}`,set:C.value.setter,selectItems:V,format:o.format,cast:o.cast,alerts:b.value},null,8,["loc","set","format","cast","alerts"]))),128)),k(R,{class:"flex justify-end gap-2 pt-4",mode:w.value,buttons:l(J),onSave:T,onCancel:u,onAdd:j},null,8,["mode","buttons"])])]),_:1})):E("",!0),g.value.length?(a(),_("div",Q,[t("div",U,[t("table",X,[e[3]||(e[3]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-date"},"Date"),t("th",{class:"t-col t-col-category"},"Category"),t("th",{class:"t-col t-col-details"},"Details"),t("th",{class:"t-col t-col-amount"},"Amount"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(a(!0),_(N,null,A(g.value,o=>(a(),_("tr",{key:o.id},[t("td",Z,c(s.$filters.dateFormat(o.created_at,"dd MMM yyyy HH:mm")),1),t("td",tt,c(o.category),1),t("td",et,c(o.details),1),t("td",ot,c(l(z)(o.amount)),1),t("td",st,[k(K,{class:"flex justify-end gap-2",onRemove:p=>l(B)(o),onEdit:p=>S(o)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",at," Total: "+c(s.$filters.currency(I.value)),1),e[2]||(e[2]=t("td",null,null,-1))])])])])])):E("",!0)]),_:1})}}});export{rt as default};
