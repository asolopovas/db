import{e as p,o as r,f as e,aq as nt,d as A,C as O,E,F as U,r as z,u,n as Z,s as Q,M as d,L as w,K as h,ap as G,ar as at,am as lt,p as b,ak as rt,T as it,x as N,q as ut,B as L,k as j,i as T,h as ct,N as I,O as R}from"./app-CniiSglE.js";import{u as dt}from"./indexView-CQwP3jlu.js";const pt={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 15 16"};function vt(g,s){return r(),p("svg",pt,s[0]||(s[0]=[e("path",{fill:"currentColor",d:"M7.5 11c-.28 0-.5-.22-.5-.5v-9c0-.28.22-.5.5-.5s.5.22.5.5v9c0 .28-.22.5-.5.5m6 4h-12c-.28 0-.5-.22-.5-.5v-2c0-.28.22-.5.5-.5s.5.22.5.5V14h11v-1.5c0-.28.22-.5.5-.5s.5.22.5.5v2c0 .28-.22.5-.5.5"},null,-1),e("path",{fill:"currentColor",d:"M7.5 12a.47.47 0 0 1-.35-.15l-3.5-3.5c-.2-.2-.2-.51 0-.71s.51-.2.71 0l3.15 3.15 3.15-3.15c.2-.2.51-.2.71 0s.2.51 0 .71l-3.5 3.5c-.1.1-.23.15-.35.15Z"},null,-1)]))}const mt={render:vt},wt={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 20 20"};function ft(g,s){return r(),p("svg",wt,s[0]||(s[0]=[nt('<g fill="currentColor"><path d="M14.5 14.5v-3.25a.5.5 0 0 1 1 0V15a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V5a.5.5 0 0 1 .5-.5h3.75a.5.5 0 0 1 0 1H5.5v9z"></path><path d="M10.354 10.354a.5.5 0 0 1-.708-.708l5-5a.5.5 0 0 1 .708.708z"></path><path d="M15.5 8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 1 0z"></path><path d="M11.5 5.5a.5.5 0 0 1 0-1H15a.5.5 0 0 1 0 1z"></path></g>',1)]))}const ht={render:ft},gt={xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24"};function _t(g,s){return r(),p("svg",gt,s[0]||(s[0]=[e("path",{fill:"currentColor",d:"M3.548 20.938h16.9a.5.5 0 0 0 0-1h-16.9a.5.5 0 0 0 0 1M9.71 17.22a2.6 2.6 0 0 0 1.12-.65l9.54-9.54a1.75 1.75 0 0 0 0-2.47l-.94-.93a1.79 1.79 0 0 0-2.47 0l-9.54 9.53a2.5 2.5 0 0 0-.64 1.12L6.04 17a.74.74 0 0 0 .19.72.77.77 0 0 0 .53.22Zm.41-1.36a1.47 1.47 0 0 1-.67.39l-.97.26-1-1 .26-.97a1.5 1.5 0 0 1 .39-.67l.38-.37 1.99 1.99Zm1.09-1.08-1.99-1.99 6.73-6.73 1.99 1.99Zm8.45-8.45 2.99.97-1.99-1.99 1.01-1.02a.75.75 0 0 1 1.06 0l.93.94a.754.754 0 0 1 0 1.06Z"},null,-1)]))}const yt={render:_t},xt={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24"};function bt(g,s){return r(),p("svg",xt,s[0]||(s[0]=[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m20 9-1.995 11.346A2 2 0 0 1 16.035 22h-8.07a2 2 0 0 1-1.97-1.654L4 9m17-3h-5.625M3 6h5.625m0 0V4a2 2 0 0 1 2-2h2.75a2 2 0 0 1 2 2v2m-6.75 0h6.75"},null,-1)]))}const kt={render:bt},$t=["data-label","innerHTML"],Ct={class:"t-col t-col-action","data-label":"Action"},Vt={class:"flex gap-2 items-center justify-end md:flex text-neutral-50"},Ot=A({__name:"Order",props:{item:{type:Object,required:!0},fields:{type:Object},filters:{type:Object,default:()=>({grand_total:"currency",balance:"currency",vat:"percentage"})},loading:Boolean},emits:["deleteOrder","loading"],setup(g,{emit:s}){const k=G(),$=E(),_=g,{item:v,fields:B}=_,y=O(()=>$.state.auth.access_token),M=(a,o)=>{if(_.filters.hasOwnProperty(o)){const l=_.filters[o];return at[l](a)}return a},f=a=>{k.push({path:`/orders/${a}/details`})},m=async()=>{try{const a=await lt(`/api/orders/${v.id}/download`,{method:"GET"}),o=window.URL.createObjectURL(new Blob([a.data])),l=document.createElement("a");l.href=o,l.setAttribute("download",`Customer - ${v.customer} #${v.id}.pdf`),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(o)}catch(a){console.error("Failed to download the file:",a)}},q=()=>{const a=window.screen.availHeight,o=window.screen.availWidth/2,l=Date.now();window.open(`/api/orders/${v.id}/pdf-default?token=${y.value}&time=${l}`,"_blank",`location=true,resizable=yes,scrollbars=yes,status=yes,width=${o},height=${a},left=0,top=0`)};return(a,o)=>{const l=h("base-button");return r(),p("tr",null,[(r(!0),p(U,null,z(u(B),(C,x,S)=>(r(),p("td",{key:S,"data-label":u(Q)(x),class:Z(C.class),innerHTML:M(u(v)[x],x)},null,10,$t))),128)),e("td",Ct,[e("div",Vt,[d(l,{class:"btn-action bg-red-500",onClick:o[0]||(o[0]=C=>a.$emit("deleteOrder",u(v)))},{default:w(()=>[d(u(kt))]),_:1}),d(l,{class:"btn-action bg-yellow-400 text-zinc-600",onClick:q},{default:w(()=>[d(u(ht))]),_:1}),d(l,{class:"btn-action bg-blue-600",onClick:m},{default:w(()=>[d(u(mt))]),_:1}),d(l,{class:"btn-action bg-green-600",onClick:o[1]||(o[1]=C=>f(u(v).id))},{default:w(()=>[d(u(yt))]),_:1})])])])}}}),Bt={class:"flex flex-wrap gap-4"},Mt={class:"w-full max-w-[1200px] mx-auto"},St={class:"px-4 overflow-auto w-full"},Ft={class:"md:table-auto"},Lt=["onClick"],qt={key:0},It=A({__name:"Orders",setup(g){const s=it(),k=G(),$=E(),_=$.state.pagination,{pageSwitch:v,fetchData:B}=dt(),y=b(!1),M=b(!1),f=b(null),m=b(null),q=b(null),a=b(null),o=rt({orderStatus:null,various:null,vat:null}),l={id:{},customer:{sort:"firstname"},notes:{width:350},review_request:{},photo_request:{}},C={id:{class:"t-col t-col-id uppercase"},date:{sort:"created_at",class:"t-col t-col-date",format:n=>"$filters.dateFormat(date)"},customer:{width:200,sort:"firstname",class:"t-col t-col-customer"},address:{sort:"address_line_1",class:"t-col t-col-address"},status:{class:"t-col t-col-status"},grand_total:{class:"t-col t-col-grandtotal",width:121},vat:{class:"t-col t-col-vat"},balance:{class:"t-col t-col-balance"}},x=O(()=>$.state.items[s.name].items),S=O(()=>{const n={get(t,i){return typeof t[i]=="object"&&t[i]!==null?new Proxy(t[i],n):i in t?t[i]:null}};return q.value==="notes"?new Proxy(l,n):new Proxy(C,n)}),P=O(()=>{const n={orderBy:H.value},t=Object.entries(o).reduce((i,[D,V])=>(V&&V!=="null"&&(i[D]=V),i),{});return Object.keys(t).length&&(n.filters=t),n}),H=O(()=>f.value&&m.value?[f.value,m.value]:[]),K=n=>{a.value=n,y.value=!0},W=()=>{a.value&&$.dispatch("orderDelete",{routeName:s.name,id:a.value.id}).then(()=>{y.value=!1})},Y=n=>{n&&Object.assign(o,{orderStatus:n.orderStatus||null,various:n.various||null,vat:n.vat||null})},J=()=>{o.orderStatus=null,o.various=null,o.vat=null,k.push({query:{}})},X=(n,t)=>{const i=n||t;if(f.value!==i){f.value=i,m.value="desc";return}m.value=m.value==="desc"?"asc":"desc"};return N(()=>H.value,()=>{k.push({query:P.value})}),N(()=>o,()=>{k.push({query:P.value})},{deep:!0}),N(s,()=>{B()}),ut(async()=>{Y(s.query.filters),s.query.orderBy&&([f.value,m.value]=s.query.orderBy),await B()}),(n,t)=>{const i=h("modal"),D=h("spinner"),V=h("options"),tt=h("base-button"),et=h("pagination"),ot=h("main-layout");return r(),L(ot,null,{options:w(()=>[e("div",Bt,[d(V),I(e("select",{class:"h-[40px] px-4","onUpdate:modelValue":t[1]||(t[1]=c=>o.orderStatus=c),name:"statusFilters"},t[6]||(t[6]=[e("option",{value:"null"},"Status",-1),e("option",{value:"quote"},"Quotes",-1),e("option",{value:"invoice"},"Invoice",-1)]),512),[[R,o.orderStatus]]),I(e("select",{class:"h-[40px] px-4","onUpdate:modelValue":t[2]||(t[2]=c=>o.various=c),name:"variousFilters"},t[7]||(t[7]=[e("option",{value:null,selected:""}," Filter ",-1),e("option",{value:"paid"},"Paid",-1),e("option",{value:"unpaid"},"Unpaid",-1),e("option",{value:"in_progress"},"In Progress",-1),e("option",{value:"tax_deductions"},"Tax Deductions",-1)]),512),[[R,o.various]]),I(e("select",{class:"h-[40px] px-2","onUpdate:modelValue":t[3]||(t[3]=c=>o.vat=c),name:"variousFilters"},t[8]||(t[8]=[e("option",{value:null},"Vat",-1),e("option",{value:"20"},"Vat 20%",-1),e("option",{value:"5"},"Vat 5%",-1),e("option",{value:"0"},"Vat 0%",-1)]),512),[[R,o.vat]]),d(tt,{class:"options-button btn-action bg-sky-600 text-white",onClick:J},{default:w(()=>t[9]||(t[9]=[T("Reset",-1)])),_:1,__:[9]})])]),default:w(()=>[y.value?(r(),L(i,{key:0,class:"yes-no-box",controls:!0,onClose:t[0]||(t[0]=c=>y.value=!1),onYes:W},{default:w(()=>t[5]||(t[5]=[T(" Do you really want to delete this order? ",-1)])),_:1,__:[5]})):j("",!0),M.value?(r(),L(D,{key:1})):j("",!0),e("div",Mt,[e("div",St,[e("table",Ft,[e("thead",null,[e("tr",null,[(r(!0),p(U,null,z(S.value,(c,F,st)=>(r(),p("th",{key:st,scope:"col",class:Z(["t-col cursor-pointer select-none",c.class]),onClick:Dt=>X(c.sort,F)},ct(u(Q)(String(F))),11,Lt))),128)),t[10]||(t[10]=e("th",{class:"t-col text-right px-2"},"Action",-1))])]),e("tbody",null,[(r(!0),p(U,null,z(x.value,c=>(r(),L(Ot,{key:c.id,item:c,fields:S.value,onDeleteOrder:K,onLoading:t[4]||(t[4]=F=>M.value=F)},null,8,["item","fields"]))),128)),x.value.length?j("",!0):(r(),p("tr",qt,t[11]||(t[11]=[e("td",{colspan:"10",class:"t-col text-center font-bold"}," Sorry No Records Found ",-1)])))])]),d(et,{class:"w-full justify-end py-2 bg-neutral-100","click-handler":u(v),"per-slice":5,"current-page":u(_).current_page,"last-page":u(_).last_page},null,8,["click-handler","current-page","last-page"])])])]),_:1})}}});export{It as default};
