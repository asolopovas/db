import{d as K,p as m,C as _,E as Y,j as D,B as f,L as r,k as N,e as y,u as c,K as b,i as h,f as t,M as g,r as k,au as z,F as B,h as a,T as G,o as l}from"./app-Dk6oj0LN.js";import{u as H,b as J}from"./useConfirmation-ESVQ-FOg.js";const O={class:"mt-2"},W={key:2,class:"table-wrap"},X={class:"table-container"},Z={class:"table-order-edit"},tt={"data-label":"Name",class:"t-col t-col-name"},et={"data-label":"Quantity",class:"t-col t-col-quantity"},ot={"data-label":"Unit Price",class:"t-col t-col-unit-price"},nt={"data-label":"Discount",class:"t-col t-col-price"},st={"data-label":"Price",class:"t-col t-col-price"},at={"data-label":"Action",class:"t-col t-col-action"},lt={colspan:"5",class:"t-col text-right"},ut=K({__name:"Services",setup(it){const{confirmationModal:P,promptDeletion:T,confirmDeletion:w,cancelDeletion:S}=H(),i=Y(),x=G(),u=m(!1),d=m("add"),q=m([]),C=_(()=>i.state.order.order_services),s=_(()=>i.state.order.order_service),A=_(()=>D(s.value.unit_price*s.value.quantity)),V=_(()=>C.value.reduce((e,o)=>e+o.unit_price*(1-o.discount/100)*o.quantity,0)),E=m({setter:"setServiceItem",parent:"order.order_service",items:{service:{type:"input-search",format:e=>`${e.name}${e.price?" - "+D(e.price):""}`},quantity:{type:"input-field",cast:"number"},unit_price:{type:"input-field",cast:"number"},discount:{type:"input-field",cast:"number"},price:{type:"display-field",compute:e=>e.unit_price*(1-e.discount/100)*e.quantity}}});function p(){u.value=!1,d.value="add",i.commit("resetEl","order_service")}function j(){if(q.value=F(s.value,["service","quantity","unit_price"]),!q.value.length){const e=s.value.discount,o={order_id:x.params.id,service_id:s.value.service.id,unit_price:s.value.unit_price,discount:e===""?0:e,quantity:s.value.quantity};i.dispatch("addEl",{el:o,endpoint:"order_service"}).then(p)}}function I(e){u.value=!0,d.value="edit",i.commit("editEl",{loc:"order_service",el:e})}function M(){i.dispatch("saveEl",{el:{service_id:s.value.service.id,unit_price:s.value.unit_price,discount:s.value.discount,quantity:s.value.quantity},endpoint:"order_service"}).then(p)}function R(){w(async e=>{i.dispatch("removeEl",{loc:"order_services",el:e})})}function F(e,o){return o.filter(v=>!e[v])}return(e,o)=>{const v=b("modal"),L=b("action-buttons"),Q=b("view-buttons"),U=b("order-components");return l(),f(U,{onAddItem:o[0]||(o[0]=n=>u.value=!0)},{title:r(()=>o[1]||(o[1]=[h("Services",-1)])),default:r(()=>[c(P)?(l(),f(v,{key:0,controls:!0,class:"send",onClose:c(S),onNo:c(S),onYes:R},{default:r(()=>o[2]||(o[2]=[h(" Do you confirm deletion? ",-1)])),_:1,__:[2]},8,["onClose","onNo"])):N("",!0),u.value?(l(),f(v,{key:1,onClose:p},{title:r(()=>[h(a(e.$filters.startCase(d.value))+" Service",1)]),default:r(()=>[(l(!0),y(B,null,k(E.value.items,(n,$)=>(l(),f(z(n.type),{key:$,cast:n.cast,loc:`${E.value.parent}.${$}`,set:E.value.setter,format:n.format,alerts:q.value},null,8,["cast","loc","set","format","alerts"]))),128)),t("span",O,[o[3]||(o[3]=t("b",null,"Sub-Total: ",-1)),h(a(A.value),1)]),g(L,{class:"flex justify-end gap-2 pt-4",mode:d.value,buttons:c(J),onSave:M,onCancel:p,onAdd:j},null,8,["mode","buttons"])]),_:1})):N("",!0),C.value.length?(l(),y("div",W,[t("div",X,[t("table",Z,[o[5]||(o[5]=t("thead",null,[t("tr",null,[t("th",{class:"t-col t-col-name"},"Name"),t("th",{class:"t-col t-col-quantity"},"Quantity"),t("th",{class:"t-col t-col-unit-price"},"Unit Price"),t("th",{class:"t-col t-col-unit-price"},"Discount"),t("th",{class:"t-col t-col-price"},"Price"),t("th",{class:"t-col t-col-action"},"Action")])],-1)),t("tbody",null,[(l(!0),y(B,null,k(C.value,n=>(l(),y("tr",{key:n.id},[t("td",tt,a(n.service.name),1),t("td",et,a(n.quantity)+" units ",1),t("td",ot,a(e.$filters.currency(n.unit_price))+" p/unit ",1),t("td",nt,a(n.discount)+"% ",1),t("td",st,a(e.$filters.currency(n.price)),1),t("td",at,[g(Q,{class:"flex justify-end gap-2",onRemove:()=>c(T)(n),onEdit:$=>I(n)},null,8,["onRemove","onEdit"])])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",lt," Total: "+a(c(D)(V.value)),1),o[4]||(o[4]=t("td",null,null,-1))])])])])])):N("",!0)]),_:1})}}});export{ut as default};
