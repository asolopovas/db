import{d as G,C as Y,T as z,p as m,D as _,E as f,o as a,B as y,G as r,i as b,u as i,j as N,h as c,e as h,r as k,au as H,F as D,f as e,L as B,k as S}from"./app-Cn69L5Cc.js";import{u as J,b as K}from"./useConfirmation-D0auDgnd.js";const O={class:"mt-2"},W={key:2,class:"table-wrap"},X={class:"table-container"},Z={class:"table-order-edit"},ee={"data-label":"Name",class:"t-col t-col-name"},te={"data-label":"Quantity",class:"t-col t-col-quantity"},oe={"data-label":"Unit Price",class:"t-col t-col-unit-price"},ne={"data-label":"Price",class:"t-col t-col-price"},se={"data-label":"Action",class:"t-col t-col-action"},ae={colspan:"4",class:"t-col text-right"},re=G({__name:"Services",setup(le){const{confirmationModal:P,promptDeletion:T,confirmDeletion:w,cancelDeletion:g}=J(),l=Y(),x=z(),u=m(!1),d=m("add"),q=m([]),C=_(()=>l.state.order.order_services),s=_(()=>l.state.order.order_service),A=_(()=>S(s.value.unit_price*s.value.quantity)),V=_(()=>C.value.reduce((t,o)=>t+o.unit_price*o.quantity,0)),E=m({setter:"setServiceItem",parent:"order.order_service",items:{service:{type:"input-search",format:t=>`${t.name}${t.price?" - "+S(t.price):""}`},quantity:{type:"input-field",cast:"number"},unit_price:{type:"input-field",cast:"number"},price:{type:"display-field",compute:t=>t.unit_price*t.quantity}}});function p(){u.value=!1,d.value="add",l.commit("resetEl","order_service")}function j(){q.value=L(s.value,["service","quantity","unit_price"]),q.value.length||l.dispatch("addEl",{el:{order_id:x.params.id,service_id:s.value.service.id,unit_price:s.value.unit_price,quantity:s.value.quantity},endpoint:"order_service"}).then(p)}function I(t){u.value=!0,d.value="edit",l.commit("editEl",{loc:"order_service",el:t})}function R(){l.dispatch("saveEl",{el:{service_id:s.value.service.id,unit_price:s.value.unit_price,quantity:s.value.quantity},endpoint:"order_service"}).then(p)}function F(){w(async t=>{l.dispatch("removeEl",{loc:"order_services",el:t})})}function L(t,o){return o.filter(v=>!t[v])}return(t,o)=>{const v=f("modal"),M=f("action-buttons"),Q=f("view-buttons"),U=f("order-components");return a(),y(U,{onAddItem:o[0]||(o[0]=n=>u.value=!0)},{title:r(()=>o[1]||(o[1]=[b("Services")])),default:r(()=>[i(P)?(a(),y(v,{key:0,controls:!0,class:"send",onClose:i(g),onNo:i(g),onYes:F},{default:r(()=>o[2]||(o[2]=[b(" Do you confirm deletion? ")])),_:1},8,["onClose","onNo"])):N("",!0),u.value?(a(),y(v,{key:1,onClose:p},{title:r(()=>[b(c(t.$filters.startCase(d.value))+" Service",1)]),default:r(()=>[(a(!0),h(D,null,k(E.value.items,(n,$)=>(a(),y(H(n.type),{key:$,cast:n.cast,loc:`${E.value.parent}.${$}`,set:E.value.setter,format:n.format,alerts:q.value},null,8,["cast","loc","set","format","alerts"]))),128)),e("span",O,[o[3]||(o[3]=e("b",null,"Sub-Total: ",-1)),b(c(A.value),1)]),B(M,{class:"flex justify-end gap-2 pt-4",mode:d.value,buttons:i(K),onSave:R,onCancel:p,onAdd:j},null,8,["mode","buttons"])]),_:1})):N("",!0),C.value.length?(a(),h("div",W,[e("div",X,[e("table",Z,[o[5]||(o[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"t-col t-col-name"}," Name "),e("th",{scope:"col",class:"t-col t-col-quantity"}," Quantity "),e("th",{scope:"col",class:"t-col t-col-unit-price"}," Unit Price "),e("th",{scope:"col",class:"t-col t-col-price"}," Price "),e("th",{scope:"col",class:"t-col t-col-action"}," Action ")])],-1)),e("tbody",null,[(a(!0),h(D,null,k(C.value,n=>(a(),h("tr",{key:n.id},[e("td",ee,c(n.service.name),1),e("td",te,c(n.quantity)+" units ",1),e("td",oe,c(t.$filters.currency(n.unit_price))+" p/unit ",1),e("td",ne,c(t.$filters.currency(n.price)),1),e("td",se,[B(Q,{class:"flex justify-end gap-2",onRemove:()=>i(T)(n),onEdit:$=>I(n)},null,8,["onRemove","onEdit"])])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",ae," Total: "+c(i(S)(V.value)),1),o[4]||(o[4]=e("td",null,null,-1))])])])])])):N("",!0)]),_:1})}}});export{re as default};
