import{d as z,p as c,ar as S,C as j,E as K,B as m,L as s,e as _,k as p,f as a,r as O,F as k,K as g,i as l,h as J,M as r,au as X,N as Z,Q as ee,ap as te,o as n,am as L}from"./app-CniiSglE.js";import{_ as se}from"./DisplayField.vue_vue_type_script_setup_true_lang-CkV3fwRE.js";const oe=["src"],ae={class:"max-w-[1004px] mx-auto shadow-lg"},le={class:"flex flex-wrap bg-stone-200 mx-auto mt-4 py-4"},re={class:"flex flex-col gap-3 items-start w-full p-4"},ne={class:"grid md:grid-cols-2 lg:grid-cols-4 w-full gap-2 mb-4"},ie={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-3 w-full"},de={class:"flex flex-col w-full"},ue={class:"order-controls grid md:grid-cols-2 lg:grid-cols-4 gap-2"},ce={class:"flex flex-col mb-4 w-full"},me={class:"messages-controls grid grid-cols-2 lg:grid lg:grid-cols-4 gap-2"},fe={class:"flex gap-4 w-full justify-end pb-12"},pe={class:"toggle-container"},ge={class:"w-1/2 grid grid-cols-2 gap-2 col-start-2 items-center"},ye=z({__name:"Details",setup(ve){const U=te(),i=K(),E=c({}),x=c(!1),v=c(!1),M=c(null),D=c(!1),N=c(!1),B=c(!1),w=c([]),F=c({setter:"setOrderStats",parent:"order",items:{customer:{type:"input-search",format:t=>`${t.firstname} ${t.lastname}`},status:{type:"input-search"},project:{type:"input-search",format:t=>t?t.street:""},company:{type:"input-search"}}}),C=c({setter:"setOrderStats",parent:"order",items:{date_due:{type:"input-field",cast:"date",format:t=>S.dateFormat(t,"yyyy-MM-dd")},vat:{type:"input-field"},discount:{type:"input-field"},due:{type:"input-field"},due_amount:{type:"input-field"}}}),R=c({setter:"setOrderStats",parent:"order",items:{created_at:{label:"Created At",type:"display-field",format:S.dateFormat},updated_at:{label:"Updated At",type:"display-field",format:S.dateFormat},sent:{type:"display-field",format:S.dateFormat}}}),I=j({get:()=>i.state.order.reverse_charge,set:t=>{i.commit("setOrderStats",{value:t,loc:"reverse_charge"}),$(!1)}}),T=j(()=>i.state.auth.access_token);async function q(){x.value=!1,v.value=!0,await i.dispatch("orderSend"),v.value=!1}function $(t=!1){w.value.length||(v.value=!0,i.dispatch("orderSave",t).then(()=>v.value=!1))}const V=async()=>{const t=i.state.order.status.name==="Quote"?"/api/settings/get/quotation_message":"/api/settings/get/invoice_message";try{const{data:e}=await L(t,{method:"GET"});i.commit("setOrderStats",{value:e,loc:"mail_message"}),$(!0)}catch(e){console.error("Failed to fetch mail message:",e)}};function Y(){i.dispatch("orderSaveItem",{mail_message:i.state.order.mail_message})}const A=async()=>{try{const{data:t}=await L(`/api/orders/${i.state.order.id}/download`,{method:"GET",responseType:"blob"}),e=t,h=window.URL.createObjectURL(e),d=document.createElement("a");d.href=h;const b=i.state.order,y=[b.customer.firstname,b.customer.lastname].filter(Boolean).join("-");d.download=`Order #${b.id} - ${y}.pdf`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(h)}catch(t){console.error("Failed to download invoice:",t)}};function G(){const t=Date.now(),e=`width=${window.screen.availWidth/2},height=${window.screen.availHeight-60}`;window.open(`/api/orders/${i.state.order.id}/pdf-reverse-charge?token=${T.value}&time=${t}`,"_blank",e)}function H(){const t=Date.now(),e=`location=true,resizable=yes,scrollbars=yes,status=yes,width=${window.screen.availWidth/2},height=${window.screen.availHeight-60},left=0,top=0`;window.open(`/api/orders/${i.state.order.id}/pdf-default?token=${T.value}&time=${t}`,"_blank",e)}function P(){const t=i.state.order,e=[t.customer.firstname,t.customer.lastname].filter(Boolean).join(" ");U.push({name:"orders",query:{search:e}})}return(t,e)=>{const h=g("spinner"),d=g("modal"),b=g("input-field"),y=g("text-area"),u=g("base-button"),Q=g("input-search"),W=g("order-components");return n(),m(W,{ref:"detailsContainer"},{title:s(()=>e[12]||(e[12]=[l("Details",-1)])),loading:s(()=>[v.value?(n(),m(h,{key:0})):p("",!0)]),meta:s(()=>[(n(!0),_(k,null,O(R.value.items,(o,f)=>(n(),m(se,{key:f,label:o.label,format:o.format,alerts:w.value,loc:`${R.value.parent}.${f}`},null,8,["label","format","alerts","loc"]))),128))]),default:s(()=>[(n(!0),_(k,null,O(E.value,(o,f)=>(n(),_(k,{key:f},[o.shown?(n(),m(d,{key:0,class:"send",controls:!0,onClose:()=>o.shown=!1,onYes:o.action,onNo:()=>o.shown=!1},{default:s(()=>[l(J(o.message),1)]),_:2},1032,["onClose","onYes","onNo"])):p("",!0)],64))),128)),x.value?(n(),m(d,{key:0,class:"send",controls:!0,onClose:e[0]||(e[0]=()=>x.value=!1),onYes:q},{default:s(()=>e[13]||(e[13]=[l(" Do you wish to send this order? ",-1)])),_:1,__:[13]})):p("",!0),M.value?(n(),m(d,{key:1,class:"pdf",controls:!1,onClose:e[1]||(e[1]=()=>M.value=null)},{default:s(()=>[a("embed",{id:"pdf",src:M.value,type:"application/pdf",width:"1000",height:"550"},null,8,oe)]),_:1})):p("",!0),D.value?(n(),m(d,{key:2,class:"textarea",onClose:e[2]||(e[2]=o=>D.value=!1)},{title:s(()=>e[14]||(e[14]=[l("Mail Message",-1)])),default:s(()=>[r(b,{set:"setOrderStats",loc:"order.cc",alerts:w.value},null,8,["alerts"]),r(y,{class:"mb-4",labelOn:!1,set:"setOrderStats",loc:"order.mail_message",action:Y}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:V},{default:s(()=>e[15]||(e[15]=[l(" Default ",-1)])),_:1,__:[15]})]),_:1})):p("",!0),B.value?(n(),m(d,{key:3,class:"textarea",onClose:e[4]||(e[4]=o=>B.value=!1)},{title:s(()=>e[16]||(e[16]=[l("Payment Terms",-1)])),default:s(()=>[r(y,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.payment_terms"}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:e[3]||(e[3]=()=>$(!0))},{default:s(()=>e[17]||(e[17]=[l(" Save ",-1)])),_:1,__:[17]})]),_:1})):p("",!0),N.value?(n(),m(d,{key:4,class:"textarea",onClose:e[5]||(e[5]=o=>N.value=!1)},{title:s(()=>e[18]||(e[18]=[l("Notes",-1)])),default:s(()=>[r(y,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.notes"}),r(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:V},{default:s(()=>e[19]||(e[19]=[l(" Default ",-1)])),_:1,__:[19]})]),_:1})):p("",!0),a("div",ae,[a("div",le,[a("div",re,[a("div",ne,[(n(!0),_(k,null,O(F.value.items,(o,f)=>(n(),m(Q,{wrap:"w-full md:w-auto",class:"w-full lg:max-w-[195px]",is:o.type,set:F.value.setter,format:o.format,cast:o.cast,alerts:w.value,loc:`${C.value.parent}.${f}`},null,8,["is","set","format","cast","alerts","loc"]))),256))]),a("div",ie,[(n(!0),_(k,null,O(C.value.items,(o,f)=>(n(),m(X(o.type),{class:"w-full lg:w-auto",label:f,set:C.value.setter,format:o.format,cast:o.cast,alerts:w.value,loc:`${C.value.parent}.${f}`},null,8,["label","set","format","cast","alerts","loc"]))),256))]),a("div",de,[e[24]||(e[24]=a("hr",null,null,-1)),a("div",ue,[r(u,{class:"btn-action bg-red-400",onClick:G},{default:s(()=>e[20]||(e[20]=[l(" Reverse Charge Invoice ",-1)])),_:1,__:[20]}),r(u,{class:"btn-action bg-yellow-500",onClick:H},{default:s(()=>e[21]||(e[21]=[l(" View Invoice ",-1)])),_:1,__:[21]}),r(u,{class:"btn-action bg-green-600 text-white",onClick:A},{default:s(()=>e[22]||(e[22]=[l(" Download Invoice ",-1)])),_:1,__:[22]}),r(u,{class:"btn-action bg-orange-400",onClick:P},{default:s(()=>e[23]||(e[23]=[l(" View Related Orders ",-1)])),_:1,__:[23]})])]),a("div",ce,[e[28]||(e[28]=a("hr",{class:"mb-1"},null,-1)),a("div",me,[r(u,{class:"btn-action bg-sky-600 text-white",onClick:e[6]||(e[6]=()=>D.value=!0)},{default:s(()=>e[25]||(e[25]=[l(" Mail ",-1)])),_:1,__:[25]}),r(u,{class:"btn-action bg-sky-600 text-white",onClick:e[7]||(e[7]=()=>N.value=!0)},{default:s(()=>e[26]||(e[26]=[l(" Notes ",-1)])),_:1,__:[26]}),r(u,{class:"btn-action bg-sky-600 text-white col-span-2 lg:col-span-1",onClick:e[8]||(e[8]=()=>B.value=!0)},{default:s(()=>e[27]||(e[27]=[l(" Payment Terms ",-1)])),_:1,__:[27]})])]),a("div",fe,[a("div",pe,[e[29]||(e[29]=a("label",{class:"toggle-label select-none cursor-pointer",for:"reverse-charge"},"Reverse Charge",-1)),Z(a("input",{id:"reverse-charge",type:"checkbox",class:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>I.value=o)},null,512),[[ee,I.value]]),e[30]||(e[30]=a("label",{for:"reverse-charge",class:"switch cursor-pointer"},null,-1))]),a("div",ge,[r(u,{class:"btn-action bg-yellow-300 hover:bg-yellow-400 text-black",onClick:e[10]||(e[10]=()=>x.value=!0)},{default:s(()=>e[31]||(e[31]=[l(" Send ",-1)])),_:1,__:[31]}),r(u,{class:"btn-action bg-green-700 hover:bg-green-800 text-white",onClick:e[11]||(e[11]=o=>$(!1))},{default:s(()=>e[32]||(e[32]=[l(" Save ",-1)])),_:1,__:[32]})])])])])])]),_:1},512)}}});export{ye as default};
