import{d as K,ao as Q,C as J,p as c,ar as S,D as V,E as p,o as r,B as m,G as s,i as a,j as g,e as k,r as O,F as x,h as X,f as l,L as n,au as Z,H as ee,K as te,am as L}from"./app-Cn69L5Cc.js";import{_ as se}from"./DisplayField.vue_vue_type_script_setup_true_lang-DFxlu8Ec.js";const oe=["src"],ae={class:"max-w-[1004px] mx-auto shadow-lg"},le={class:"flex flex-wrap bg-stone-200 mx-auto mt-4 py-4"},re={class:"flex flex-col gap-3 items-start w-full p-4"},ne={class:"grid md:grid-cols-2 lg:grid-cols-4 w-full gap-2 mb-4"},ie={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-3 w-full"},de={class:"flex flex-col w-full"},ue={class:"order-controls grid md:grid-cols-2 lg:grid-cols-4 gap-2"},ce={class:"flex flex-col mb-4 w-full"},me={class:"messages-controls grid grid-cols-2 lg:grid lg:grid-cols-4 gap-2"},fe={class:"flex gap-4 w-full justify-end pb-12"},pe={class:"toggle-container"},ge={class:"w-1/2 grid grid-cols-2 gap-2 col-start-2 items-center"},ye=K({__name:"Details",setup(ve){const U=Q(),i=J(),E=c({}),C=c(!1),v=c(!1),D=c(null),M=c(!1),B=c(!1),F=c(!1),w=c([]),N=c({setter:"setOrderStats",parent:"order",items:{customer:{type:"input-search",format:t=>`${t.firstname} ${t.lastname}`},status:{type:"input-search"},project:{type:"input-search",format:t=>t?t.street:""},company:{type:"input-search"}}}),$=c({setter:"setOrderStats",parent:"order",items:{date_due:{type:"input-field",cast:"date",format:t=>S.dateFormat(t,"yyyy-MM-dd")},vat:{type:"input-field"},discount:{type:"input-field"},due:{type:"input-field"},due_amount:{type:"input-field"}}}),R=c({setter:"setOrderStats",parent:"order",items:{created_at:{label:"Created At",type:"display-field",format:S.dateFormat},updated_at:{label:"Updated At",type:"display-field",format:S.dateFormat},sent:{type:"display-field",format:S.dateFormat}}}),j=V({get:()=>i.state.order.reverse_charge,set:t=>{i.commit("setOrderStats",{value:t,loc:"reverse_charge"}),_(!1)}}),I=V(()=>i.state.auth.access_token);async function q(){C.value=!1,v.value=!0,await i.dispatch("orderSend"),v.value=!1}function _(t=!1){w.value.length||(v.value=!0,i.dispatch("orderSave",t).then(()=>v.value=!1))}const T=async()=>{const t=i.state.order.status.name==="Quote"?"/api/settings/get/quotation_message":"/api/settings/get/invoice_message";try{const{data:e}=await L(t,{method:"GET"});i.commit("setOrderStats",{value:e,loc:"mail_message"}),_(!0)}catch(e){console.error("Failed to fetch mail message:",e)}};function G(){i.dispatch("orderSaveItem",{mail_message:i.state.order.mail_message})}const H=async()=>{try{const{data:t}=await L(`/api/orders/${i.state.order.id}/download`,{method:"GET",responseType:"blob"}),e=t,h=window.URL.createObjectURL(e),d=document.createElement("a");d.href=h;const b=i.state.order,y=[b.customer.firstname,b.customer.lastname].filter(Boolean).join("-");d.download=`Order #${b.id} - ${y}.pdf`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(h)}catch(t){console.error("Failed to download invoice:",t)}};function Y(){const t=Date.now(),e=`width=${window.screen.availWidth/2},height=${window.screen.availHeight-60}`;window.open(`/api/orders/${i.state.order.id}/pdf-reverse-charge?token=${I.value}&time=${t}`,"_blank",e)}function A(){const t=Date.now(),e=`location=true,resizable=yes,scrollbars=yes,status=yes,width=${window.screen.availWidth/2},height=${window.screen.availHeight-60},left=0,top=0`;window.open(`/api/orders/${i.state.order.id}/pdf-default?token=${I.value}&time=${t}`,"_blank",e)}function P(){const t=i.state.order,e=[t.customer.firstname,t.customer.lastname].filter(Boolean).join(" ");U.push({name:"orders",query:{search:e}})}return(t,e)=>{const h=p("spinner"),d=p("modal"),b=p("input-field"),y=p("text-area"),u=p("base-button"),W=p("input-search"),z=p("order-components");return r(),m(z,{ref:"detailsContainer"},{title:s(()=>e[12]||(e[12]=[a("Details")])),loading:s(()=>[v.value?(r(),m(h,{key:0})):g("",!0)]),meta:s(()=>[(r(!0),k(x,null,O(R.value.items,(o,f)=>(r(),m(se,{key:f,label:o.label,format:o.format,alerts:w.value,loc:`${R.value.parent}.${f}`},null,8,["label","format","alerts","loc"]))),128))]),default:s(()=>[(r(!0),k(x,null,O(E.value,(o,f)=>(r(),k(x,{key:f},[o.shown?(r(),m(d,{key:0,class:"send",controls:!0,onClose:()=>o.shown=!1,onYes:o.action,onNo:()=>o.shown=!1},{default:s(()=>[a(X(o.message),1)]),_:2},1032,["onClose","onYes","onNo"])):g("",!0)],64))),128)),C.value?(r(),m(d,{key:0,class:"send",controls:!0,onClose:e[0]||(e[0]=()=>C.value=!1),onYes:q},{default:s(()=>e[13]||(e[13]=[a(" Do you wish to send this order? ")])),_:1})):g("",!0),D.value?(r(),m(d,{key:1,class:"pdf",controls:!1,onClose:e[1]||(e[1]=()=>D.value=null)},{default:s(()=>[l("embed",{id:"pdf",src:D.value,type:"application/pdf",width:"1000",height:"550"},null,8,oe)]),_:1})):g("",!0),M.value?(r(),m(d,{key:2,class:"textarea",onClose:e[2]||(e[2]=o=>M.value=!1)},{title:s(()=>e[14]||(e[14]=[a("Mail Message")])),default:s(()=>[n(b,{set:"setOrderStats",loc:"order.cc",alerts:w.value},null,8,["alerts"]),n(y,{class:"mb-4",labelOn:!1,set:"setOrderStats",loc:"order.mail_message",action:G}),n(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:T},{default:s(()=>e[15]||(e[15]=[a(" Default ")])),_:1})]),_:1})):g("",!0),F.value?(r(),m(d,{key:3,class:"textarea",onClose:e[4]||(e[4]=o=>F.value=!1)},{title:s(()=>e[16]||(e[16]=[a("Payment Terms")])),default:s(()=>[n(y,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.payment_terms"}),n(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:e[3]||(e[3]=()=>_(!0))},{default:s(()=>e[17]||(e[17]=[a(" Save ")])),_:1})]),_:1})):g("",!0),B.value?(r(),m(d,{key:4,class:"textarea",onClose:e[5]||(e[5]=o=>B.value=!1)},{title:s(()=>e[18]||(e[18]=[a("Notes")])),default:s(()=>[n(y,{labelOn:!1,class:"mb-4",set:"setOrderStats",loc:"order.notes"}),n(u,{class:"btn-action bg-sky-600 self-end text-white",onClick:T},{default:s(()=>e[19]||(e[19]=[a(" Default ")])),_:1})]),_:1})):g("",!0),l("div",ae,[l("div",le,[l("div",re,[l("div",ne,[(r(!0),k(x,null,O(N.value.items,(o,f)=>(r(),m(W,{wrap:"w-full md:w-auto",class:"w-full lg:max-w-[195px]",is:o.type,set:N.value.setter,format:o.format,cast:o.cast,alerts:w.value,loc:`${$.value.parent}.${f}`},null,8,["is","set","format","cast","alerts","loc"]))),256))]),l("div",ie,[(r(!0),k(x,null,O($.value.items,(o,f)=>(r(),m(Z(o.type),{class:"w-full lg:w-auto",label:f,set:$.value.setter,format:o.format,cast:o.cast,alerts:w.value,loc:`${$.value.parent}.${f}`},null,8,["label","set","format","cast","alerts","loc"]))),256))]),l("div",de,[e[24]||(e[24]=l("hr",null,null,-1)),l("div",ue,[n(u,{class:"btn-action bg-red-400",onClick:Y},{default:s(()=>e[20]||(e[20]=[a(" Reverse Charge Invoice ")])),_:1}),n(u,{class:"btn-action bg-yellow-500",onClick:A},{default:s(()=>e[21]||(e[21]=[a(" View Invoice ")])),_:1}),n(u,{class:"btn-action bg-green-600 text-white",onClick:H},{default:s(()=>e[22]||(e[22]=[a(" Download Invoice ")])),_:1}),n(u,{class:"btn-action bg-orange-400",onClick:P},{default:s(()=>e[23]||(e[23]=[a(" View Related Orders ")])),_:1})])]),l("div",ce,[e[28]||(e[28]=l("hr",{class:"mb-1"},null,-1)),l("div",me,[n(u,{class:"btn-action bg-sky-600 text-white",onClick:e[6]||(e[6]=()=>M.value=!0)},{default:s(()=>e[25]||(e[25]=[a(" Mail ")])),_:1}),n(u,{class:"btn-action bg-sky-600 text-white",onClick:e[7]||(e[7]=()=>B.value=!0)},{default:s(()=>e[26]||(e[26]=[a(" Notes ")])),_:1}),n(u,{class:"btn-action bg-sky-600 text-white col-span-2 lg:col-span-1",onClick:e[8]||(e[8]=()=>F.value=!0)},{default:s(()=>e[27]||(e[27]=[a(" Payment Terms ")])),_:1})])]),l("div",fe,[l("div",pe,[e[29]||(e[29]=l("label",{class:"toggle-label select-none cursor-pointer",for:"reverse-charge"},"Reverse Charge",-1)),ee(l("input",{id:"reverse-charge",type:"checkbox",class:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>j.value=o)},null,512),[[te,j.value]]),e[30]||(e[30]=l("label",{for:"reverse-charge",class:"switch cursor-pointer"},null,-1))]),l("div",ge,[n(u,{class:"btn-action bg-yellow-300 hover:bg-yellow-400 text-black",onClick:e[10]||(e[10]=()=>C.value=!0)},{default:s(()=>e[31]||(e[31]=[a(" Send ")])),_:1}),n(u,{class:"btn-action bg-green-700 hover:bg-green-800 text-white",onClick:e[11]||(e[11]=o=>_(!1))},{default:s(()=>e[32]||(e[32]=[a(" Save ")])),_:1})])])])])])]),_:1},512)}}});export{ye as default};
